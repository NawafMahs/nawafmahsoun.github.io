let e={maxLCP:2500,maxFID:100,maxCLS:.1,maxMemoryUsage:104857600,currentUsage:{jsSize:0,cssSize:0,memoryUsage:0,lcp:0,fid:0,cls:0},violations:[]};function t(){"undefined"!=typeof window&&(function(){if(!window.PerformanceObserver)return;new PerformanceObserver(t=>{for(const n of t.getEntries())e.currentUsage.lcp=n.startTime,n.startTime>e.maxLCP&&r("LCP",n.startTime,e.maxLCP)}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(t=>{for(const n of t.getEntries()){const t=n.processingStart-n.startTime;e.currentUsage.fid=t,t>e.maxFID&&r("FID",t,e.maxFID)}}).observe({entryTypes:["first-input"]});let t=0;new PerformanceObserver(n=>{for(const e of n.getEntries())e.hadRecentInput||(t+=e.value);e.currentUsage.cls=t,t>e.maxCLS&&r("CLS",t,e.maxCLS)}).observe({entryTypes:["layout-shift"]})}(),performance.memory&&setInterval(()=>{const t=performance.memory.usedJSHeapSize;e.currentUsage.memoryUsage=t,t>e.maxMemoryUsage&&r("Memory",t,e.maxMemoryUsage)},3e3),new PerformanceObserver(t=>{for(const r of t.getEntries())"script"===r.initiatorType?e.currentUsage.jsSize+=r.transferSize||0:"link"===r.initiatorType&&r.name.includes(".css")&&(e.currentUsage.cssSize+=r.transferSize||0)}).observe({entryTypes:["resource"]}),setInterval(s,5e3))}function r(t,r,s){const a={metric:t,actual:r,limit:s,timestamp:Date.now(),severity:n(r,s)};e.violations.push(a),"critical"===a.severity&&function(e){switch(e){case"Memory":window.gc&&window.gc(),document.body.setAttribute("data-performance-mode","true");break;case"LCP":case"FID":document.body.setAttribute("data-reduced-motion","true");break;case"CLS":document.body.setAttribute("data-stable-layout","true")}}(t)}function n(e,t){const r=e/t;return r>2?"critical":r>1.5?"high":r>1.1?"medium":"low"}function s(){e.violations.filter(e=>Date.now()-e.timestamp<1e4).length>3&&document.body.setAttribute("data-performance-mode","true")}export{t as initPerformanceBudget};
