import{j as e}from"./jsx-runtime-i88aexF6.js";import{r}from"./vendor-react-vendor-C-CbGDQp.js";import{al as t,aq as n,P as a,am as s,$ as o,aw as c,D as i,aE as u,ap as d,H as l,W as p,O as m,aF as f,ao as w,C as h,V as y,a0 as v}from"./vendor-three-vendor-BYQyMLel.js";import{a as g,V as x}from"./three-stdlib-C8EuNLCY.js";import{b as j,r as R}from"./image-BJ49fZDF.js";import{b as S,c as M,n as b}from"./heading-BdKyha8q.js";import{r as T,c as k,a as A,t as E,m as P}from"./three-DIuK_0bK.js";import{M as z}from"./route-CpjGb5A4.js";import{t as C}from"./throttle-C5AzcUjb.js";import{u as D,a as L,c as F}from"./vendor-animation-vendor-CcTNfguF.js";import"./vendor-remix-vendor-Bg8iBN6h.js";import"./slice-app-C7u_2Rr3.js";import"./meta-DKrU2Bxz.js";import"./config-D0y_boNB.js";import"./preload-helper-oqmhCI76.js";import"./visually-hidden-C2IlVvQv.js";import"./useScrollToHash-B1BZb9H3.js";import"./divider-BoGco-_J.js";import"./decoder-text-DscqFfvK.js";import"./useWindowSize-IhI1IMqA.js";const _={stiffness:40,damping:20,mass:1.4,restSpeed:.001},W=({models:h,show:y=!0,showDelay:v=0,cameraPosition:R={x:0,y:0,z:8},style:E,className:P,onLoad:z,alt:F,...W})=>{const[I,N]=r.useState(!1),U=r.useRef(),X=r.useRef(),G=r.useRef(),O=r.useRef(),q=r.useRef(),J=r.useRef(),V=r.useRef(),Y=r.useRef(),Z=r.useRef(),$=r.useRef(),B=r.useRef(),K=r.useRef(),Q=r.useRef(),ee=r.useRef(),re=r.useRef(),te=r.useRef(),ne=r.useRef(),ae=j(U,!1,{threshold:.2}),se=D(),oe=L(0,_),ce=L(0,_);r.useEffect(()=>{const{clientWidth:e,clientHeight:r}=U.current;J.current=new t({canvas:X.current,alpha:!0,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),J.current.setPixelRatio(2),J.current.setSize(e,r),J.current.outputColorSpace=n,G.current=new a(36,e/r,.1,100),G.current.position.set(R.x,R.y,R.z),q.current=new s,O.current=new o,q.current.add(O.current);const h=new c(16777215,1.2),y=new i(16777215,1.1),v=new i(16777215,.8);v.position.set(-6,2,2),y.position.set(.5,0,.866),re.current=[h,y,v],re.current.forEach(e=>q.current.add(e)),V.current=new o,q.current.add(V.current),V.current.position.set(0,0,-.8),V.current.rotateX(Math.PI/2);const j=512;Y.current=new u(j,j),Y.current.texture.generateMipmaps=!1,Z.current=new u(j,j),Z.current.texture.generateMipmaps=!1;const S=new d(8,8).rotateX(Math.PI/2),M=new l({map:Y.current.texture,opacity:.8,transparent:!0});ee.current=new p(S,M),ee.current.scale.y=-1,V.current.add(ee.current),te.current=new p(S),te.current.visible=!1,V.current.add(te.current);const b=new l({color:16777215,opacity:0,transparent:!0});ne.current=new p(S,b),ne.current.rotateX(Math.PI),ne.current.position.y-=1e-5,V.current.add(ne.current),$.current=new m(-4,4,4,-4,0,1.5),$.current.rotation.x=Math.PI/2,V.current.add($.current),B.current=new f,B.current.userData.darkness={value:3},B.current.onBeforeCompile=e=>{e.uniforms.darkness=B.current.userData.darkness,e.fragmentShader=`\n        uniform float darkness;\n        ${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}\n      `},B.current.depthTest=!1,B.current.depthWrite=!1,K.current=new w(g),K.current.depthTest=!1,Q.current=new w(x),Q.current.depthTest=!1;const E=oe.on("change",ue),P=ce.on("change",ue);return()=>{Y.current.dispose(),Z.current.dispose(),T(re.current),k(q.current),A(J.current),E(),P()}},[]);const ie=r.useCallback(e=>{te.current.visible=!0,te.current.material=K.current,te.current.material.uniforms.tDiffuse.value=Y.current.texture,K.current.uniforms.h.value=e*(1/256),J.current.setRenderTarget(Z.current),J.current.render(te.current,$.current),te.current.material=Q.current,te.current.material.uniforms.tDiffuse.value=Z.current.texture,Q.current.uniforms.v.value=e*(1/256),J.current.setRenderTarget(Y.current),J.current.render(te.current,$.current),te.current.visible=!1},[]),ue=r.useCallback(()=>{const e=q.current.background;q.current.background=null,q.current.overrideMaterial=B.current,J.current.setRenderTarget(Y.current),J.current.render(q.current,$.current),q.current.overrideMaterial=null,ie(5),ie(2),J.current.setRenderTarget(null),q.current.background=e,O.current.rotation.x=oe.get(),O.current.rotation.y=ce.get(),J.current.render(q.current,G.current)},[ie,oe,ce]);return r.useEffect(()=>{const e=C(e=>{const{innerWidth:r,innerHeight:t}=window,n=(e.clientX-r/2)/r,a=(e.clientY-t/2)/t;ce.set(n/2),oe.set(a/2)},100);return ae&&!se&&window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[ae,se,oe,ce]),r.useEffect(()=>{const e=()=>{if(!U.current)return;const{clientWidth:e,clientHeight:r}=U.current;J.current.setSize(e,r),G.current.aspect=e/r,G.current.updateProjectionMatrix(),ue()};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[ue]),e.jsxs("div",{className:M("_model_fphsv_2",P),"data-loaded":I,style:S({delay:b(v)},E),ref:U,role:"img","aria-label":F,...W,children:[e.jsx("canvas",{className:"_canvas_fphsv_11",ref:X}),h.map((r,t)=>e.jsx(H,{renderer:J,modelGroup:O,show:y,showDelay:v,renderFrame:ue,index:t,setLoaded:N,onLoad:z,model:r},JSON.stringify(r.position)))]})},H=({renderer:e,model:t,modelGroup:a,renderFrame:s,index:o,showDelay:c,setLoaded:i,onLoad:u,show:d})=>{const[l,p]=r.useState(),m=D(),f=r.createRef();r.useEffect(()=>{const r=async(r,t)=>{r.colorSpace=n,r.flipY=!1,r.anisotropy=e.current.capabilities.getMaxAnisotropy(),r.generateMipmaps=!1,await e.current.initTexture(r),t.material.color=new h(16777215),t.material.transparent=!0,t.material.map=r};p({start:async()=>{const{texture:e,position:n,url:i}=t;let u,d;const[l,p]=await Promise.all([await E.loadAsync(e.placeholder),await P.loadAsync(i)]);a.current.add(p.scene),p.scene.traverse(async t=>{t.material&&(t.material.color=new h(2039845)),"Screen"===t.name&&(f.current=t.clone(),f.current.material=t.material.clone(),t.parent.add(f.current),f.current.material.opacity=1,f.current.position.z+=.001,r(l,f.current),u=async()=>{const n=await R(e),a=await E.loadAsync(n);await r(a,t),F(1,0,{onUpdate:e=>{f.current.material.opacity=e,s()}})})});const w=new y(n.x,n.y,n.z);return m&&p.scene.position.set(...w.toArray()),t.animation===z.SpringUp&&(d=()=>{const e=new y(w.x,w.y-1,w.z);p.scene.position.set(...e.toArray()),F(e.y,w.y,{type:"spring",delay:(300*o+c)/1e3,stiffness:60,damping:20,mass:1,restSpeed:1e-4,restDelta:1e-4,onUpdate:e=>{p.scene.position.y=e,s()}})}),t.animation===z.LaptopOpen&&(d=()=>{const e=p.scene.children.find(e=>"Frame"===e.name),r=new y(v.degToRad(90),0,0),t=new y(0,0,0);return p.scene.position.set(...w.toArray()),e.rotation.set(...r.toArray()),F(r.x,t.x,{type:"spring",delay:(300*o+c+300)/1e3,stiffness:80,damping:20,restSpeed:1e-4,restDelta:1e-4,onUpdate:r=>{e.rotation.x=r,s()}})}),{loadFullResTexture:u,playAnimation:d}}})},[]),r.useEffect(()=>{if(!l||!d)return;let e;return r.startTransition(()=>{(async()=>{const{loadFullResTexture:r,playAnimation:t}=await l.start();i(!0),u?.(),m||(e=t()),await r(),m&&s()})()}),()=>{e?.stop()}},[l,d])};export{W as Model};
