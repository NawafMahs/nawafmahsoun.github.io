import{j as e}from"./jsx-runtime-i88aexF6.js";import{f as t,d as r,c as n,a as s,m as a,L as i,t as c}from"./heading-BdKyha8q.js";import{r as o}from"./vendor-react-vendor-C-CbGDQp.js";import{O as u,H as l}from"./three-stdlib-C8EuNLCY.js";import{V as m,al as d,aq as p,ar as f,P as h,am as w,au as y,av as v,aw as x,D as g,at as b,ax as j,c as E,ay as _,az as S,s as R,aA as k}from"./vendor-three-vendor-BYQyMLel.js";import{c as z}from"./clamp-kM_hmJiM.js";import{r as A,c as C,a as N,g as F,t as M,m as L}from"./three-DIuK_0bK.js";import{t as P}from"./throttle-C5AzcUjb.js";import{u as T,a as D}from"./vendor-animation-vendor-CcTNfguF.js";import{S as O}from"./meta-DKrU2Bxz.js";import{b as H}from"./image-BJ49fZDF.js";import{u as W}from"./useWindowSize-IhI1IMqA.js";import"./vendor-remix-vendor-Bg8iBN6h.js";import"./config-D0y_boNB.js";const q={x:0,y:0,z:2},B=(e,t,r)=>e+r*(t-e),I=e=>Object.keys(e).map(t=>parseFloat(Math.round(100*e[t])/100).toFixed(2)).join(", "),J=e=>e&&e.camera?{x:e.camera[0],y:e.camera[1],z:e.camera[2]}:q,Y={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},Z={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},V={stiffness:40,damping:30},X=o.createContext({}),K=({position:K=[0,0,0],scale:U=1,hideMeshes:$=[],labels:G=[],className:Q,children:ee})=>{const[te,re]=o.useState(!1),[ne,se]=o.useState(!1),[ae,ie]=o.useState(!1),[ce,oe]=o.useState(!1),ue=o.useRef([]),le=o.useRef(),me=o.useRef(),de=o.useRef(),pe=o.useRef(),fe=o.useRef(),he=o.useRef(),we=o.useRef(),ye=o.useRef(),ve=o.useRef(),xe=o.useRef(),ge=o.useRef(),be=o.useRef(),je=H(de),Ee=o.useRef(),_e=o.useRef(J(ue.current[0])),Se=o.useRef([]),Re=o.useRef(),ke=o.useRef(),ze=o.useRef(),Ae=o.useRef(),{width:Ce,height:Ne}=W(),Fe=T(),Me=D(0,Y),Le=D(0,Y),Pe=D(0,Y),Te=D(0,Z),De=D(0,Z),Oe=D(0,Z),He=D(0,V),We=o.useCallback(()=>{if(!je)return void cancelAnimationFrame(Ee.current);Ee.current=requestAnimationFrame(We);const e=we.current.getDelta();be.current.update(e),Re.current.update(),fe.current.render(pe.current,he.current),Se.current.forEach(e=>{const{element:r,position:n,sprite:s}=e,a=new m(...n),i=he.current.position.distanceTo(xe.current.position),c=he.current.position.distanceTo(s.position)>i;a.project(he.current),a.x=Math.round((.5+a.x/2)*window.innerWidth),a.y=Math.round((.5-a.y/2)*window.innerHeight),r.style.setProperty("--posX",t(a.x)),r.style.setProperty("--posY",t(a.y)),r.dataset.occluded=!!c})},[je]);o.useEffect(()=>{Ae.current=!0;const{innerWidth:e,innerHeight:t}=window;fe.current=new d({canvas:de.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),fe.current.setPixelRatio(1),fe.current.outputColorSpace=p,fe.current.toneMapping=f,he.current=new h(54,e/t,.1,100),he.current.position.x=_e.current.x,he.current.position.y=_e.current.y,he.current.position.z=_e.current.z,he.current.lookAt(0,0,0),Me.set(he.current.position.x,!1),Le.set(he.current.position.y,!1),Pe.set(he.current.position.z,!1),pe.current=new w,we.current=new y,ve.current=new v;const r=new x(2236962,.05),n=new g(16777215,1.5);n.position.set(3,0,1);const s=[r,n];return s.forEach(e=>pe.current.add(e)),Re.current=new u(he.current,de.current),Re.current.enableZoom=!1,Re.current.enablePan=!1,Re.current.enableDamping=!1,Re.current.rotateSpeed=.5,()=>{Ae.current=!1,cancelAnimationFrame(Ee.current),A(s),C(pe.current),N(fe.current)}},[]),o.useEffect(()=>{const e=()=>{se(!0),Me.stop(),Le.stop(),Pe.stop()},t=()=>{Me.set(he.current.position.x,!1),Le.set(he.current.position.y,!1),Pe.set(he.current.position.z,!1),se(!1)};return Re.current.addEventListener("start",e),Re.current.addEventListener("end",t),()=>{Re.current.removeEventListener("start",e),Re.current.removeEventListener("end",t)}},[Me,Le,Pe]),o.useEffect(()=>{if(!te)return;const e=F("Chunk",xe.current),t=F("Atmosphere",xe.current),r=(e,t)=>{he.current.position[e]=t},n=Me.on("change",e=>r("x",e)),s=Le.on("change",e=>r("y",e)),a=Pe.on("change",e=>r("z",e)),i=(t,r)=>{e.position[t]=r},c=Te.on("change",e=>i("x",e)),o=De.on("change",e=>i("y",e)),u=Oe.on("change",e=>i("z",e)),l=He.on("change",e=>{t.material.opacity=e});return()=>{n(),s(),a(),c(),o(),u(),l()}},[Me,Le,Pe,Te,De,Oe,te,He]),o.useEffect(()=>{Ce<=r.tablet&&(Re.current.enabled=!1)},[Ce]),o.useEffect(()=>{if(te)return;const e=new l,t=new b(fe.current);t.compileCubemapShader();const r=async()=>{const e=await L.loadAsync("/assets/earth-DvZudj9K.glb");xe.current=e.scene,ge.current=e.animations,be.current=new k(xe.current),be.current.timeScale=.1,xe.current.traverse(async e=>{const{material:t,name:r}=e;"Atmosphere"===r&&(t.alphaMap=t.map),t&&await fe.current.initTexture(t)}),xe.current.position.x=K[0],xe.current.position.y=K[1],xe.current.position.z=K[2],xe.current.scale.x=U,xe.current.scale.y=U,xe.current.scale.z=U},n=async()=>{const r=await e.loadAsync(["/assets/milkyway-nx-Ds_hwpSC.hdr","/assets/milkyway-ny-BqhFvupA.hdr","/assets/milkyway-nz-D6l6T-pv.hdr","/assets/milkyway-px-BjIdbMt0.hdr","/assets/milkyway-py-BD6pEbZF.hdr","/assets/milkyway-pz-Bx3WFS88.hdr"]);r.magFilter=R,ke.current=t.fromCubemap(r),t.dispose(),await fe.current.initTexture(ke.current.texture)},s=async()=>{const e=await M.loadAsync("/assets/milkyway-Vkpv7LbT.jpg");e.mapping=S,e.colorSpace=p,pe.current.background=e,await fe.current.initTexture(e)};o.startTransition(()=>{(async()=>{await Promise.all([s(),n(),r()]),xe.current.traverse(({material:e})=>{e&&(e.envMap=ke.current.texture,e.needsUpdate=!0)}),Ae.current&&re(!0)})(),setTimeout(()=>{oe(!0)},1e3)})},[te,K,U]),o.useEffect(()=>(te&&!ze.current&&(pe.current.add(xe.current),ze.current=!0),te&&je&&(ie(!0),We()),()=>{cancelAnimationFrame(Ee.current)}),[We,je,te]),o.useEffect(()=>{te&&(me.current.innerHTML="",Se.current=G.map(e=>{const t=document.createElement("div");t.classList.add("_label_1awhs_52"),t.dataset.hidden=!0,t.style.setProperty("--delay",`${e.delay||0}ms`),t.textContent=e.text,me.current.appendChild(t);const r=new j;return r.position.set(...e.position),r.scale.set(60,60,1),{element:t,...e,sprite:r}}))},[G,te]),o.useEffect(()=>{fe.current.setSize(Ce,Ne),he.current.aspect=Ce/Ne,he.current.updateProjectionMatrix()},[Ce,Ne]),o.useEffect(()=>{const e=de.current,t=e=>{const{innerWidth:t,innerHeight:r}=window;I(he.current.position),ye.current=new E(e.clientX/t*2-1,-e.clientY/r*2+1),ve.current.setFromCamera(ye.current,he.current);const n=ve.current.intersectObjects(pe.current.children,!0);n.length>0&&I(n[0].point)};return()=>{e.removeEventListener("click",t)}},[]);const qe=o.useCallback(()=>{if(!le.current)return;const{offsetTop:e}=le.current,{innerHeight:t}=window,r=window.scrollY-e;let n;requestAnimationFrame(()=>{const e=ue.current.length-1,s=Math.floor(r/t),a=z(s,0,e),i=ue.current[a],c=ue.current[a+1],o=J(i)||q,u=J(c)||q,l=z((r-t*a)/t,0,1),d=B(o.x,u.x,l),p=B(o.y,u.y,l),f=B(o.z,u.z,l);var h;n!==o&&ue.current.length&&i&&((e=>{const t=ue.current[e].meshes;xe.current.traverse(e=>{const{name:r}=e,n=F("Chunk",xe.current),s=t?.includes(r),a=$?.includes(r);if(s)if("Atmosphere"===r)e.visible=!0,He.set(1);else if("Chunk"===r){const t=new m(-.4,.4,.4);e.visible=!0,Fe?e.position.set(...t.toArray()):(Te.set(t.x),De.set(t.y),Oe.set(t.z))}else"EarthFull"===r&&n.visible?e.visible=!1:e.visible=!0;else if(a&&!s)if("Atmosphere"===r)He.set(0);else if("Chunk"===r){const t=new m(0,0,0);((e,t)=>{const r=(e=0)=>Math.round(100*(e+Number.EPSILON))/100;return r(e?.x)===r(t?.x)&&r(e?.y)===r(t?.y)&&r(e?.z)===r(t?.z)})(t,n.position)&&(e.visible=!1),Te.set(t.x),De.set(t.y),Oe.set(t.z)}else"EarthPartial"===r&&n.visible?e.visible=!0:e.visible=!1})})(a),(e=>{const t=ue.current[e].animations;Fe||(ge.current.forEach((e,r)=>{t.find(e=>e.includes(r.toString()))||be.current.clipAction(e).reset().stop()}),ge.current.length&&ue.current[e].animations&&t.forEach(e=>{const t=e.split(":"),r=ge.current[Number(t[0])],n=be.current.clipAction(r);t[1]&&"loop"===t[1]||(n.clampWhenFinished=!0,n.loop=_),n.play()}))})(a),h=a,Se.current.forEach(e=>{e.hidden&&(e.element.dataset.hidden=!0,e.element.setAttribute("aria-hidden",!0))}),ue.current[h].labels.forEach(e=>{Se.current.filter(t=>t.text===e).forEach(e=>{e.element.dataset.hidden=!1,e.element.setAttribute("aria-hidden",!1)})})),n=o,ne||(Fe?he.current.position.set(d,p,f):(Me.set(d),Le.set(p),Pe.set(f)))})},[Me,Le,Pe,Te,De,Oe,ne,$,He,Fe]);o.useEffect(()=>{const e=P(qe,100);return te&&je&&window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}},[qe,je,te,He]);const Be=o.useCallback(e=>{ue.current=[...ue.current,e]},[]),Ie=o.useCallback(e=>{ue.current=ue.current.filter(t=>t!==e)},[]);return e.jsx(X.Provider,{value:{registerSection:Be,unregisterSection:Ie},children:e.jsxs("div",{className:n("_earth_1awhs_1",Q),ref:le,children:[e.jsxs("div",{className:"_viewport_1awhs_22",children:[e.jsx("canvas",{className:"_canvas_1awhs_33","data-visible":te&&ae,"data-grabbing":ne,ref:de}),e.jsx("div",{className:"_labels_1awhs_52","aria-live":"polite",ref:me}),e.jsx("div",{className:"_vignette_1awhs_82"})]}),e.jsx("div",{className:"_sections_1awhs_94",children:ee}),e.jsx(s,{unmount:!0,in:!te&&ce,timeout:a(c.base.durationL),children:t=>e.jsx(O,{className:"_loader_1awhs_8","data-visible":t,children:e.jsx(i,{})})})]})})},U=o.memo(({children:t,scrim:r,scrimReverse:s,className:a,camera:i=[0,0,0],animations:c=[],meshes:u=[],labels:l=[]})=>{const{registerSection:m,unregisterSection:d}=o.useContext(X),p=o.useRef(),f=JSON.stringify(c)+JSON.stringify(i)+JSON.stringify(l)+JSON.stringify(u);return o.useEffect(()=>{const e={camera:i,animations:c,meshes:u,labels:l,sectionRef:p};return m(e),()=>{d(e)}},[f,m,d]),e.jsx("div",{className:n("_section_1awhs_94",a),"data-scrim":r,"data-scrim-reverse":s,ref:p,children:t})});export{K as Earth,U as EarthSection};
